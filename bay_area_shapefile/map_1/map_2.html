<!DOCTYPE html>
<head>
<meta charset="utf-8">
<style>
  body {
        margin: 0;
        padding: 0;
    }
    #vis {
 //   width: 100%;
   // max-width: 2000px;
//    max-height: 2000px;
 //   margin: 0 auto;
    }
    #vis div {
        float: left;
        position: relative;
    }
    #vis path {
       /* //fill: #2ca25f;
        //stroke: #FFF;*/
        stroke-width: 1px;
    }
    #vis p.legend {
        width: 100%;
        text-align: center;
        position: absolute;
        bottom: 0;
        left: 0;
        font-weight: bold;
        font-size: 11px;
    }
    .container {
         padding-right:5px;
         padding-left:5px;
         margin-right:auto;
         margin-left:auto;
    }

    #options_container, #description_container, #srcs_container {
        padding: 15px;
        width:100%;
    }
</style>
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/topojson.v2.min.js"></script>
<link rel="stylesheet" href="https://ajax.aspnetcdn.com/ajax/bootstrap/3.3.6/css/bootstrap.min.css">
<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.12.4.min.js"></script>
<script src="https://ajax.aspnetcdn.com/ajax/bootstrap/3.3.6/bootstrap.min.js"></script>
</head>

<div class="container">
<div align="center">
  <h1 title="Gentrification">San Francisco Gentrification: Property Trends of 2014-2017</h1>
</div>
<div class="panel panel-default" id="description_container" style="border:1px solid #cecece;" >

        Rising property prices are pushing out people from their homes. Gentrification, the process of renovating and improving a residential district typically old and poorer areas in response to the influx of more affluent residents, has been rapidly accelerating in urban neighborhoods, specifically in the San Francisco area in California. While gentrification improves the quality of life of these neighborhoods, it also adjusts pricing for both renting and owning homes, greatly affecting the affordability. We will explore the evidence of gentrification from 2014 to 2017, in relation to the average income, home sizes (number of rooms and price per sqft), rent, rent to price ratio, etc.
        <br/><br/>
        Assumptions: We have previously determined affordability to be the percentage of income that mortability requires. 
        <br/><br/>
        Analysis: 

</div>

    <div class="panel panel-default" id="options_container" style="width:40%; float:right;">
        <div id="ownership_dropdown">

            <label>Ownership Options:</label>
            <select class="dropdown" name="ownership_options" id="ownership_options" style="width:200px"> 
                <option value="%">---------</option>
                <option value="1">Median Listing Price</option>
                <option value="2">Mortgage</option>
                <option value="3">Affordability</option>        
            </select>
        </div>
        <br/>
        <div id="own_radio">
            <label>Ownership Rooms:</label>
            <br/>
            <label class="radio-inline"><input type="radio" name="ownoptradio" id="own_1" value="1">1 Bedroom
            </label>
            <label class="radio-inline"><input type="radio" name="ownoptradio" id="own_2" value="2">2 Bedroom
            </label>
            <label class="radio-inline"><input type="radio" name="ownoptradio" id="own_3" value="3">3 Bedroom
            </label>
        </div>
        <br/>
        <div id="ownership_dropdown">
            <label>Rental Options:</label>
            <select class="dropdown" name="rental_options" id="rental_options" style="width:200px"> 
                <option value="%">---------</option>
                <option value="1">Rental Price</option>      
            </select>
        </div>
        <br/>
        <div id="room_radio">
            <label>Rental Options:</label>
            <label class="radio-inline"><input type="radio" name="optradio" id="radio_1" value="1">Multiple Family
            </label>
            <label class="radio-inline"><input type="radio" name="optradio" id="radio_2" value="2">Single Family
            </label>
            <!-- <label class="radio-inline"><input type="radio" name="optradio" id="radio_3" value="3">3 Bedroom
            </label> -->
        </div>
    </div>

<body>
     <div id='vis'></div>
<script>
var width = 600;
var height = 500;
var color_1 = d3.scaleThreshold()
    //.domain([10000, 20000, 30000, 40000, 50000, 60000, 70000, 80000])
    //.domain([1000, 1500, 2000, 2500, 3000, 3500, 4000, 5000])
    .domain([400000, 500000, 600000, 700000, 800000, 900000, 1000000, 1100000])
    .range(d3.schemeBuPu[9])

var x_1 = d3.scaleSqrt()
    .domain([400000, 1110000])
    .rangeRound([1, 300]);

var color_2 = d3.scaleThreshold()
            .domain([1000, 1500, 2000, 2500, 3000, 3500, 4000, 5000])
            .range(d3.schemeOrRd[9])

var x_2 = d3.scaleSqrt()
    .domain([1000, 5100])
    .rangeRound([1, 300]);
    
    
//var svg = d3.select("body").append("svg")
var topos = ["Bay_Area_new.topojson",
            "NY/NYC.topojson"];
    
var csv_files = [
                "Zip_Zhvi_1bedroom.csv",
                "Zip_Zhvi_2bedroom.csv",
                "Zip_Zhvi_3bedroom.csv",
                "Zip_Zri_MultiFamilyResidenceRental.csv",
                "Zip_Zri_SingleFamilyResidenceRental.csv",
                ];
    
var titles = [
              "Price-1BR",
              "Price-2BR",
              "Price-3BR",
              "Rent Multi Family",
              "Rent-Single Family",
             ];
var legend_titles = [
    "Price in dollars",
    "Price in dollars",
    "Price in dollars",
    "Rent in dollars",
    "Rent in dollars",
    
]
var colors = [color_1,
              color_1,
              color_1,
              color_2,
              color_2,
              ];
    
var xs = [x_1,
          x_1,
          x_1,
          x_2,
          x_2,
         ];
// All arrays must be same size
if ((csv_files.length != titles.length) ||
    (csv_files.length != colors.length)) {
    throw "Array lengths are not same"
}
var curr_topo_file = 0;
var curr_csv_file = 0;
var num_csv_files = csv_files.length;
console.log("here");
    
function sendArg(arg, callback)
{
    callback(null, arg);
}
function deferDrawMap(topo_index, data_index) {
    console.log("Calling deferDrawMap")
    d3.queue()
    .defer(d3.json, topos[topo_index])
    .defer(d3.csv, csv_files[data_index])
    .defer(sendArg, topo_index)
    .defer(sendArg, data_index)
    .await(DrawMap)
}
    
deferDrawMap(curr_topo_file, curr_csv_file);
    
//DrawMap(svg); 
function DrawMap(error, bay_area, csv_data, topo_index, data_index) {
    if (error) {
        throw error;
    }

    var obj = {};
    for (i = 0; i < 100000; i++) {
        obj[i] = [0, 0, 0, 0];
    }
    
    // Property Data
    csv_data.forEach(function(d) {
        obj[d.RegionName] = [d["2011-11"], d["2013-11"], d["2015-11"], d["2017-11"]];
    });
    //console.log(obj);
    // Projection changes for different cities
    var projection = d3.geoMercator()
    .center([-122.433701, 37.767683])
    .scale(25000)
    .translate([width/2, height/2]);
    var path = d3.geoPath()
      .projection(projection);
    var visualizationWrapper = d3.select('#vis');
    visualizationWrapper.selectAll("div").remove();
    
    for (i = 0; i < obj[0].length; i++)
    {
        var wrapper = visualizationWrapper.append('div')
                        .style("width", width + 'px')
                        .style("height", height + 'px');
        if (i == 0) {
            title1 = titles[data_index];
        } else {
            title1 = "";
        }
        createMap(wrapper, bay_area, obj, i, title1, 2011 + i*2);
    }
    
    function showLegend(svg)
    {
        g = svg.append("g")
        .attr("class", "key")
        .attr("transform", "translate(20,450)");

        g.selectAll("rect")
        .data(colors[data_index].range().map(function(d) {
        d = colors[data_index].invertExtent(d);
        if (d[0] == null) d[0] = xs[data_index].domain()[0];
        if (d[1] == null) d[1] = xs[data_index].domain()[1];
        return d;
        }))
    .enter().append("rect")
    .attr("height", 8)
    .attr("x", function(d) { return xs[data_index](d[0]); })
    .attr("width", function(d) { return xs[data_index](d[1]) - xs[data_index](d[0]); })
    .attr("fill", function(d) { return colors[data_index](d[0]); });

        g.append("text")
    .attr("class", "caption")
    .attr("x", xs[data_index].range()[0])
    .attr("y", -6)
    .attr("fill", "#000")
    .attr("text-anchor", "start")
    .attr("font-weight", "bold")
    .text(legend_titles[data_index]);

    var xAxis = d3.axisBottom(xs[data_index])
                .tickSize(10)
                .tickValues(colors[data_index].domain());

    g.call(xAxis)
        .select(".domain")
        .remove();
    }
    
    function createMap(wrapper, map, obj, key_metric, title1, title2)
    {


        
        var svg = wrapper.append('svg')
                .attr("width", width)
                .attr("height", height);
        
        //console.log("Drawing map for " + title2)
        svg.append("g")
        .attr("class", "Zip_areas")
        .selectAll("path")
        .data(topojson.feature(map, map.objects.Zip_areas).features)
        .enter().append("path")
        .attr("fill", function(d) {
            
            //console.log(d.properties)
            //console.log(obj[d.properties.ZIP]);
            var val = obj[d.properties.ZIP][key_metric];
            if (val == 0) {
                return "lightgrey"
            } else {
                return colors[data_index](val);
            }
        })
        .attr("stroke", "black")
        .attr("stroke-opacity", 1)
        .attr("d", path);
        

        /*Creates the title */
        svg.append("text")
        .attr("x", (50))
        .attr("y", (50))
        .attr("text-anchor", "left")
        .style("font-size", "30px")
        .text(title1); 
        
        svg.append("text")
        .attr("x", (50))
        .attr("y", (100))
        .attr("text-anchor", "left")
        .style("font-size", "30px")
        .text(title2);  

        showLegend(svg);
    }
    
    
    // Code to Redraw maps with new data
    // This can be replaced and call deferDrawMap from Buttons
    curr_csv_file++;
   /* if (curr_csv_file < num_csv_files) {
        setTimeout(function() {
            //console.log("Delay 5000");
            console.log("Draw ", topo_index, curr_csv_file);
            deferDrawMap(0, 4);
        }, 5000);
    }*/
}


$("#ownership_options").change(function(){
    var ownership_option = $( "#ownership_options" ).val();
    console.log("ownership_option", ownership_option);

    if (ownership_option == 1){
        /* Modify to show median listing price */
        deferDrawMap(0, 0);
        $("#own_1").prop("checked", true);
    }
    else if (ownership_option == 2){
        /* Modify to show mortgage */
    }
    else if (ownership_option == 3){
        /* Modify to show affordability */
    }

});

$("#own_radio").change(function(){
    var own_radio = $("input[name='ownoptradio']:checked").val();
    var ownership_option = $( "#ownership_options" ).val();
    console.log("own_radio", own_radio);

    if (own_radio == 1){
        /* Modify to show 1 bed */
        if (ownership_option == 1)
            deferDrawMap(0, 0);
    }
    else if (own_radio == 2){
        /* Modify to show 2 bed */
        if (ownership_option == 1)
            deferDrawMap(0, 1);
    }
    else if (own_radio == 3){
        /* Modify to show 3 bed */
        if (ownership_option == 1)
            deferDrawMap(0, 2);
    }

});

$("#rental_options").change(function(){
    var rental_option = $( "#rental_options" ).val();
    console.log("rental_option", rental_option);

    if (rental_option == 1){

        /*Autoselect 1 bedroom */
        $("#radio_1").prop("checked", true);
        deferDrawMap(0, 3);

        /* Modify to show rental price */

    }
});


$("#room_radio").change(function(){
    var room_radio = $("input[name='optradio']:checked").val();
    console.log("room_radio", room_radio);


    if (room_radio == 1){
        deferDrawMap(0, 3);
        /* Modify to show 1 bed */
    }
    else if (room_radio == 2){
        deferDrawMap(0, 4);
        /* Modify to show 2 bed */
    }
/*    else if (room_radio == 3){
    }*/

});



</script> 
</body>
<div class="panel panel-default" id="description_container" style="border:1px solid #cecece;" >
    <div class='row'>
        <div class='col-sm-4'>   
        </div>
    </div>


</div>
<div class="panel panel-default" id="srcs_container" style="border:1px solid #cecece;" >
    <div class='col-sm-4'>
        <div class='row'><label>Files</label></div>
        <div class='row'>Map_2.html</div>
    </div>
    <div class='col-sm-4'>
        <div class='row'><label>Data Sources</label></div>
        <div class='row'><a href="https://www.zillow.com/research/data/">Zillow Research Data</a></div>
        <div class='row'><a href="http://files.zillowstatic.com/research/public/Zip.zip">Zillow Research Data (Property Data by ZIP Code)</a></div>
        <div class='row'><a href="https://earthworks.stanford.edu/catalog/ark28722-s7888q">Bay Area ZIP Code Shapefile</a></div>
        <div class='row'><a href="https://earthworks.stanford.edu/catalog/ark28722-s7888q">Bay Area ZIP Code Shapefile</a></div>
        <div class='row'><a href="https://earthworks.stanford.edu/catalog/sde-columbia-doitt_zip_codes_2009"> New York City Zip Code Shapefile</a></div>
        <div class='row'><a href="https://www.zillow.com/howto/api/neighborhood-boundaries.htm">Neighborhood boundries</a></div>
    </div>
    <div class='row'>
        <div class='col-sm-4'>   
            <label>Visual and Code Sources</label></br>
            <a href="https://github.com/d3/d3/blob/master/API.md">D3 API Reference</a>
            <a hrerf="https://sureshlodha.github.io/CMPS165_Fall2016_FinalProjects/SantaCruzUrbanDisplacement/Urban-Displacement-Santa-Cruz/">Urban Displacement in Santa Cruz County CMPS165 Fall 2016 Project</a>
            <a href="http://frankbowers24.github.io/">Bay Area Stats using D3</a>
            <a href="http://www.urbandisplacement.org/map/sf"> Urban Displacement Project: SF Map</a>
        </div>
    </div>

</div>
<div class="panel panel-default" id="description_container" style="border:1px solid #cecece;" >

Created by Nakul Dhotre (nakul at soe.ucsc.edu) and Catherine Lu (clu47 @ ucsc.edu).
<br/>Designed for CMPS 263 Class Project

</div>
</div>